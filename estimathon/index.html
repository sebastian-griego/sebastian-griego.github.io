<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimathon Competition</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #f39c12;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
        }

        .guess-tracker {
            background: rgba(243, 156, 18, 0.1);
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .guess-tracker.warning {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .total-score {
            text-align: center;
            font-size: 2em;
            color: #f39c12;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 10px;
            border: 2px solid #f39c12;
        }
        
        .score-summary {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .score-formula {
            font-size: 0.7em;
            color: #95a5a6;
            margin-top: 10px;
            font-family: monospace;
        }

        .card {
            background: rgba(52, 52, 72, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #9b59b6;
            transition: all 0.3s;
        }

        .question.submitted {
            border-left-color: #3498db;
        }

        .question h3 {
            color: #f39c12;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        input[type="number"], input[type="text"], input[type="password"], select {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            flex: 1;
            transition: all 0.3s;
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="password"]:focus, select:focus {
            outline: none;
            border-color: #f39c12;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);
        }

        input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .submit-btn.update {
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
        }

        .score-display {
            font-size: 1.1em;
            margin-top: 10px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .score-display.correct {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .score-display.incorrect {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(52, 52, 72, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .admin-toggle:hover {
            transform: scale(1.1);
        }

        .hidden {
            display: none;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .instructions {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .note-text {
            font-size: 0.85em;
            color: #95a5a6;
            font-style: italic;
        }
        
        .guess-history {
            margin-top: 10px;
            font-size: 0.85em;
            color: #95a5a6;
        }
        
        details summary {
            cursor: pointer;
            outline: none;
        }
        
        details summary::-webkit-details-marker {
            color: #95a5a6;
        }
        
        .history-item {
            margin-bottom: 3px;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Estimathon Competition</h1>
        
        <!-- Participant Section -->
        <div id="participantSection">
            <div class="instructions">
                <strong>Instructions:</strong> Select your team (0-9) and enter your team code to begin. You have 30 total guesses across all 15 questions. 
                For each question, provide a range [min, max] that you think contains the answer.
                Each submission or update uses one of your 30 guesses. Scores are automatically sent to the spreadsheet.
                <br><br>
                <strong>Scoring:</strong> Lower scores are better! 
                Score = (10 + sum of ⌈max/min⌉ for correct guesses) × 2^(# unanswered questions)
                <br>
                
                <div style="margin-top: 15px;">
                    <label for="teamName" style="display: block; margin-bottom: 5px;">Select Your Team:</label>
                    <div class="input-group">
                        <select id="teamName" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.2); color: #e0e0e0; padding: 10px 15px; border-radius: 8px; font-size: 16px;">
                            <option value="">-- Select Team --</option>
                            <option value="Team 0">Team 0</option>
                            <option value="Team 1">Team 1</option>
                            <option value="Team 2">Team 2</option>
                            <option value="Team 3">Team 3</option>
                            <option value="Team 4">Team 4</option>
                            <option value="Team 5">Team 5</option>
                            <option value="Team 6">Team 6</option>
                            <option value="Team 7">Team 7</option>
                            <option value="Team 8">Team 8</option>
                            <option value="Team 9">Team 9</option>
                        </select>
                        <input type="password" id="teamCode" placeholder="Team code" style="max-width: 150px;">
                        <button onclick="saveTeamName()">Login</button>
                        <button onclick="logout()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); display: none;" id="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>

            <div class="guess-tracker" id="guessTracker">
                Guesses Remaining: <span id="guessesLeft">30</span> / 30
            </div>

            <div id="totalScore" class="total-score">
                🎯 Score: <span id="scoreValue">327680</span>
                <div class="score-summary">
                    <span>Correct: <span id="correctGuesses">0</span></span>
                    <span>Unanswered: <span id="mistakes">15</span></span>
                    <span>Guesses used: <span id="guessesUsed">0</span></span>
                </div>
                <div class="score-formula">
                    (10 + <span id="rangeSum">0</span>) × 2^<span id="mistakeCount">15</span> = <span id="finalScore">327680</span>
                </div>
            </div>

            <div class="card">
                <h2>Enter Your Estimates</h2>
                
                <div id="questionsContainer">
                    <!-- questions will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="adminSection" class="hidden">
            <div class="card">
                <div class="admin-header">
                    <h2>Admin Panel</h2>
                    <button class="reset-btn" onclick="resetAllData()">Reset All Data</button>
                </div>
                
                <div class="input-group">
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                    <button onclick="unlockAdmin()">Unlock</button>
                </div>
                
                <div id="adminControls" class="hidden">
                    <h3 style="margin: 20px 0;">Team Codes</h3>
                    <pre style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-size: 0.9em;">Team 0: alpha0
Team 1: beta1
Team 2: gamma2
Team 3: delta3
Team 4: epsilon4
Team 5: zeta5
Team 6: eta6
Team 7: theta7
Team 8: iota8
Team 9: kappa9</pre>
                    
                    <h3 style="margin: 20px 0;">Add/Edit Questions</h3>
                    
                    <div class="input-group">
                        <input type="text" id="newQuestion" placeholder="Question text">
                        <input type="number" id="correctAnswer" placeholder="Correct answer">
                        <button onclick="addQuestion()">Add Question</button>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px;">Current Questions</h3>
                    <div id="questionsList"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-toggle" onclick="toggleAdmin()">⚙️</div>

    <script>
        const ADMIN_PASSWORD = 'estimathon123';
        const MAX_TOTAL_GUESSES = 30;
        
        // Team codes - change these to whatever you want
        const TEAM_CODES = {
            'Team 0': 'alpha0',
            'Team 1': 'beta1',
            'Team 2': 'gamma2',
            'Team 3': 'delta3',
            'Team 4': 'epsilon4',
            'Team 5': 'zeta5',
            'Team 6': 'eta6',
            'Team 7': 'theta7',
            'Team 8': 'iota8',
            'Team 9': 'kappa9'
        };
        
        // Admin can update team codes here or in the code above
        const teamCodesInfo = `
Team Codes (change in code):
Team 0: alpha0
Team 1: beta1
Team 2: gamma2
Team 3: delta3
Team 4: epsilon4
Team 5: zeta5
Team 6: eta6
Team 7: theta7
Team 8: iota8
Team 9: kappa9
        `;
        
        // Google Sheets configuration
        const SHEET_CONFIG = {
            spreadsheetId: '1ST39xXXjrw-VXILxKP9Bjthn-cJKKna0tGBTbOqdcPg',
            apiKey: 'AIzaSyB0l94qUpcnbVRnWOJgpG0HWtd8TsgfjLI',
            range: 'Sheet1!A:Q', // adjust sheet name if needed
            updateWebAppUrl: 'https://script.google.com/macros/s/AKfycbzZWdLhAka6FISs2TFM8gmegrYdJbWq4yrdiw-iWvXQ-1cvlosTaV6BQ6fVckeVZbIQIw/exec' // from Apps Script deployment (NOT your GitHub Pages URL)
        };
        
        // tracking guesses per question
        let submittedGuesses = {};
        let totalGuessesUsed = 0;
        let incorrectCounts = {}; // tracks number of incorrect guesses per question
        let guessHistory = {}; // stores history of all guesses per question
        
        // test questions that show the answer
        let questions = JSON.parse(localStorage.getItem('estimathonQuestions')) || [
            { id: 1, text: "Test Question 1: The answer is 42", answer: 42 },
            { id: 2, text: "Test Question 2: The answer is 1337", answer: 1337 },
            { id: 3, text: "Test Question 3: The answer is 256", answer: 256 },
            { id: 4, text: "Test Question 4: The answer is 999", answer: 999 },
            { id: 5, text: "Test Question 5: The answer is 12345", answer: 12345 },
            { id: 6, text: "Test Question 6: The answer is 77", answer: 77 },
            { id: 7, text: "Test Question 7: The answer is 500", answer: 500 },
            { id: 8, text: "Test Question 8: The answer is 2048", answer: 2048 },
            { id: 9, text: "Test Question 9: The answer is 365", answer: 365 },
            { id: 10, text: "Test Question 10: The answer is 60", answer: 60 },
            { id: 11, text: "Test Question 11: The answer is 1000000", answer: 1000000 },
            { id: 12, text: "Test Question 12: The answer is 314", answer: 314 },
            { id: 13, text: "Test Question 13: The answer is 88", answer: 88 },
            { id: 14, text: "Test Question 14: The answer is 1776", answer: 1776 },
            { id: 15, text: "Test Question 15: The answer is 404", answer: 404 }
        ];

        function saveQuestions() {
            localStorage.setItem('estimathonQuestions', JSON.stringify(questions));
        }

        function updateGuessTracker() {
            const guessesLeft = MAX_TOTAL_GUESSES - totalGuessesUsed;
            document.getElementById('guessesLeft').textContent = guessesLeft;
            
            const tracker = document.getElementById('guessTracker');
            if (guessesLeft <= 10) {
                tracker.classList.add('warning');
            } else {
                tracker.classList.remove('warning');
            }
        }

        function calculateTotalScore() {
            let rangeSum = 0;
            let correctCount = 0;
            
            Object.entries(submittedGuesses).forEach(([questionId, guess]) => {
                if (guess.isCorrect) {
                    // add floor(max/min) to sum
                    rangeSum += Math.ceil(guess.max / guess.min);
                    correctCount++;
                }
            });
            
            // mistakes = total questions - correct answers
            const totalQuestions = questions.length;
            const mistakes = totalQuestions - correctCount;
            
            const totalScore = (10 + rangeSum) * Math.pow(2, mistakes);
            
            // update all display elements
            document.getElementById('scoreValue').textContent = totalScore;
            document.getElementById('correctGuesses').textContent = correctCount;
            document.getElementById('mistakes').textContent = mistakes;
            document.getElementById('guessesUsed').textContent = totalGuessesUsed;
            document.getElementById('rangeSum').textContent = rangeSum;
            document.getElementById('mistakeCount').textContent = mistakes;
            document.getElementById('finalScore').textContent = totalScore;
        }

        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            questions.forEach(q => {
                const isSubmitted = submittedGuesses[q.id] !== undefined;
                const history = guessHistory[q.id] || [];
                const questionDiv = document.createElement('div');
                questionDiv.className = `question ${isSubmitted ? 'submitted' : ''}`;
                questionDiv.innerHTML = `
                    <h3>Question ${q.id}: ${q.text}</h3>
                    <div class="input-group">
                        <div style="flex: 1;">
                            <label>Min guess:</label>
                            <input type="number" id="min-${q.id}" placeholder="Minimum" min="1" 
                                   value="${isSubmitted ? submittedGuesses[q.id].min : ''}">
                        </div>
                        <div style="flex: 1;">
                            <label>Max guess:</label>
                            <input type="number" id="max-${q.id}" placeholder="Maximum" min="1" 
                                   value="${isSubmitted ? submittedGuesses[q.id].max : ''}">
                        </div>
                        <button class="submit-btn ${isSubmitted ? 'update' : ''}" onclick="submitQuestion(${q.id})">
                            ${isSubmitted ? 'Update' : 'Submit'}
                        </button>
                    </div>
                    <div class="error" id="error-${q.id}"></div>
                    <div class="score-display ${isSubmitted ? (submittedGuesses[q.id].isCorrect ? 'correct' : 'incorrect') : 'hidden'}" 
                         id="score-${q.id}">
                        ${isSubmitted ? getScoreMessage(q.id) : ''}
                    </div>
                    ${history.length > 0 ? `
                        <div class="guess-history">
                            <details>
                                <summary>Guess History (${history.length})</summary>
                                <div style="margin-top: 5px;">
                                    ${history.map((h, index) => `
                                        <div class="history-item">
                                            ${index + 1}. [${h.min}, ${h.max}] - ${h.isCorrect ? '✓' : '✗'} - ${h.timestamp}
                                        </div>
                                    `).join('')}
                                </div>
                            </details>
                        </div>
                    ` : ''}
                `;
                container.appendChild(questionDiv);
            });
        }

        function getScoreMessage(questionId) {
            const guess = submittedGuesses[questionId];
            const question = questions.find(q => q.id === questionId);
            
            if (guess.isCorrect) {
                const contribution = Math.ceil(guess.max / guess.min);
                return `✓ Correct! Range ratio: ⌈${guess.max}/${guess.min}⌉ = ${contribution}`;
            } else {
                return `✗ Incorrect. Try again!`;
            }
        }

        function submitQuestion(questionId) {
            // check if team is selected and logged in
            if (!getTeamName() || !isTeamLoggedIn()) {
                alert('Please select your team and enter the code first!');
                return;
            }
            
            const question = questions.find(q => q.id === questionId);
            const minInput = document.getElementById(`min-${questionId}`);
            const maxInput = document.getElementById(`max-${questionId}`);
            const errorDiv = document.getElementById(`error-${questionId}`);
            
            const min = parseFloat(minInput.value);
            const max = parseFloat(maxInput.value);
            
            // reset error
            errorDiv.textContent = '';
            
            // validate
            if (!min || !max) {
                errorDiv.textContent = 'Please enter both min and max values';
                return;
            }
            
            if (min < 1) {
                errorDiv.textContent = 'Min must be at least 1';
                return;
            }
            
            if (min > max) {
                errorDiv.textContent = 'Min must be less than or equal to max';
                return;
            }
            
            // check if we have guesses left (updates now cost a guess too)
            if (totalGuessesUsed >= MAX_TOTAL_GUESSES) {
                alert('You have used all 30 guesses!');
                return;
            }
            
            // check if the guess is the same as the previous one
            const previousGuess = submittedGuesses[questionId];
            const isSameGuess = previousGuess && previousGuess.min === min && previousGuess.max === max;
            
            if (!isSameGuess) {
                // check if correct
                const isCorrect = min <= question.answer && max >= question.answer;
                
                // track incorrect guesses
                if (!isCorrect) {
                    if (!incorrectCounts[questionId]) {
                        incorrectCounts[questionId] = 0;
                    }
                    incorrectCounts[questionId]++;
                } else {
                    // if now correct, reset incorrect count
                    incorrectCounts[questionId] = 0;
                }
                
                // save the guess
                submittedGuesses[questionId] = {
                    min: min,
                    max: max,
                    isCorrect: isCorrect
                };
                
                // add to history
                if (!guessHistory[questionId]) {
                    guessHistory[questionId] = [];
                }
                guessHistory[questionId].push({
                    min: min,
                    max: max,
                    isCorrect: isCorrect,
                    timestamp: new Date().toLocaleTimeString()
                });
                
                // increment totalGuessesUsed only if the guess is different
                totalGuessesUsed++;
                
                updateGuessTracker();
                calculateTotalScore();
                
                // automatically submit to Google Sheets
                submitToGoogleSheets();
                
                // re-render to show submitted state
                renderQuestions();
            }
        }

        function toggleAdmin() {
            const adminSection = document.getElementById('adminSection');
            const participantSection = document.getElementById('participantSection');
            
            if (adminSection.classList.contains('hidden')) {
                adminSection.classList.remove('hidden');
                participantSection.classList.add('hidden');
            } else {
                adminSection.classList.add('hidden');
                participantSection.classList.remove('hidden');
            }
        }

        function unlockAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('adminControls').classList.remove('hidden');
                renderAdminQuestions();
            } else {
                alert('Incorrect password');
            }
        }

        function renderAdminQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';
            
            questions.forEach(q => {
                const div = document.createElement('div');
                div.className = 'question';
                div.innerHTML = `
                    <p><strong>Q${q.id}:</strong> ${q.text}</p>
                    <p>Answer: ${q.answer}</p>
                    <button onclick="deleteQuestion(${q.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); margin-top: 10px;">
                        Delete
                    </button>
                `;
                list.appendChild(div);
            });
        }

        function addQuestion() {
            const questionText = document.getElementById('newQuestion').value;
            const answer = parseFloat(document.getElementById('correctAnswer').value);
            
            if (!questionText || (!answer && answer !== 0)) {
                alert('Please fill in all fields');
                return;
            }
            
            const newId = Math.max(...questions.map(q => q.id), 0) + 1;
            questions.push({
                id: newId,
                text: questionText,
                answer: answer
            });
            
            saveQuestions();
            renderAdminQuestions();
            renderQuestions();
            
            // clear inputs
            document.getElementById('newQuestion').value = '';
            document.getElementById('correctAnswer').value = '';
        }

        function deleteQuestion(id) {
            questions = questions.filter(q => q.id !== id);
            // also remove any submitted guesses for this question
            if (guessHistory[id]) {
                // decrement by the number of guesses made for this question
                totalGuessesUsed -= guessHistory[id].length;
                delete submittedGuesses[id];
                delete incorrectCounts[id];
                delete guessHistory[id];
                updateGuessTracker();
                calculateTotalScore();
            }
            saveQuestions();
            renderAdminQuestions();
            renderQuestions();
        }

        function resetAllData() {
            if (confirm('Are you sure you want to reset all questions to defaults? This will also clear all submitted guesses.')) {
                localStorage.removeItem('estimathonQuestions');
                submittedGuesses = {};
                incorrectCounts = {};
                guessHistory = {};
                totalGuessesUsed = 0;
                location.reload();
            }
        }

        // Google Sheets Integration Functions
        async function submitToGoogleSheets() {
            const teamName = getTeamName();
            if (!teamName || !isTeamLoggedIn()) {
                // silently fail if no team selected or not logged in
                return;
            }
            
            // Calculate values for each question
            const values = new Array(15).fill(''); // empty array for 15 questions
            
            questions.forEach((q, index) => {
                if (index < 15) {
                    if (submittedGuesses[q.id]) {
                        if (submittedGuesses[q.id].isCorrect) {
                            // correct answer: send the ratio
                            const guess = submittedGuesses[q.id];
                            values[index] = Math.ceil(guess.max / guess.min);
                        } else {
                            // incorrect answer: send x's based on number of incorrect attempts
                            const incorrectCount = incorrectCounts[q.id] || 1;
                            values[index] = 'x'.repeat(incorrectCount);
                        }
                    }
                }
            });
            
            // Send to Google Apps Script Web App
            try {
                const response = await fetch(SHEET_CONFIG.updateWebAppUrl, {
                    method: 'POST',
                    mode: 'no-cors', // important for CORS
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        team: teamName,
                        ratios: values
                    })
                });
                
                // silently succeed - no alerts
                console.log('Scores submitted to spreadsheet');
            } catch (error) {
                console.error('Error submitting scores:', error);
                // fail silently - don't interrupt the user
            }
        }

        function getTeamName() {
            return document.getElementById('teamName').value;
        }

        function isTeamLoggedIn() {
            const teamName = getTeamName();
            const savedTeam = localStorage.getItem('teamName');
            const savedCode = localStorage.getItem('teamCode');
            
            return teamName && savedTeam === teamName && savedCode === TEAM_CODES[teamName];
        }

        function saveTeamName() {
            const teamName = document.getElementById('teamName').value;
            const teamCode = document.getElementById('teamCode').value;
            
            if (!teamName) {
                alert('Please select a team!');
                return;
            }
            
            if (TEAM_CODES[teamName] !== teamCode) {
                alert('Incorrect team code!');
                return;
            }
            
            // check if switching teams
            const currentTeamData = localStorage.getItem('currentTeamData');
            if (currentTeamData !== teamName) {
                // switching teams - clear all previous data
                submittedGuesses = {};
                incorrectCounts = {};
                guessHistory = {};
                totalGuessesUsed = 0;
            }
            
            localStorage.setItem('teamName', teamName);
            localStorage.setItem('teamCode', teamCode);
            localStorage.setItem('currentTeamData', teamName);
            alert('Logged in successfully!');
            
            // show logout button, hide login elements
            document.getElementById('teamName').disabled = true;
            document.getElementById('teamCode').style.display = 'none';
            document.querySelector('button[onclick="saveTeamName()"]').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline-block';
            
            // reset guesses for new login
            submittedGuesses = {};
            incorrectCounts = {};
            guessHistory = {};
            totalGuessesUsed = 0;
            updateGuessTracker();
            calculateTotalScore();
            renderQuestions();
        }
        
        function logout() {
            localStorage.removeItem('teamName');
            localStorage.removeItem('teamCode');
            localStorage.removeItem('currentTeamData');
            
            // reset UI
            document.getElementById('teamName').value = '';
            document.getElementById('teamName').disabled = false;
            document.getElementById('teamCode').value = '';
            document.getElementById('teamCode').style.display = 'inline-block';
            document.querySelector('button[onclick="saveTeamName()"]').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'none';
            
            // clear all data
            submittedGuesses = {};
            incorrectCounts = {};
            guessHistory = {};
            totalGuessesUsed = 0;
            updateGuessTracker();
            calculateTotalScore();
            renderQuestions();
            
            alert('Logged out successfully!');
        }

        // initialize
        renderQuestions();
        updateGuessTracker();
        calculateTotalScore();
        
        // Load team name if saved and still valid
        const savedTeamName = localStorage.getItem('teamName');
        const savedCode = localStorage.getItem('teamCode');
        if (savedTeamName && savedCode && TEAM_CODES[savedTeamName] === savedCode) {
            document.getElementById('teamName').value = savedTeamName;
            document.getElementById('teamCode').value = savedCode;
            
            // show logged in state
            document.getElementById('teamName').disabled = true;
            document.getElementById('teamCode').style.display = 'none';
            document.querySelector('button[onclick="saveTeamName()"]').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline-block';
        } else {
            // clear invalid login
            localStorage.removeItem('teamName');
            localStorage.removeItem('teamCode');
        }
    </script>
</body>
</html>