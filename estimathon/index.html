<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimathon Competition</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #f39c12;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
        }

        .guess-tracker {
            background: rgba(243, 156, 18, 0.1);
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .guess-tracker.warning {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .card {
            background: rgba(52, 52, 72, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #9b59b6;
            transition: all 0.3s;
        }

        .question.submitted {
            opacity: 0.7;
            border-left-color: #3498db;
        }

        .question h3 {
            color: #f39c12;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        input[type="number"], input[type="text"], input[type="password"] {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            flex: 1;
            transition: all 0.3s;
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #f39c12;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);
        }

        input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .score-display {
            font-size: 1.1em;
            margin-top: 10px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .score-display.correct {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .score-display.incorrect {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(52, 52, 72, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .admin-toggle:hover {
            transform: scale(1.1);
        }

        .hidden {
            display: none;
        }

        .total-score {
            text-align: center;
            font-size: 2em;
            color: #f39c12;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 10px;
            border: 2px solid #f39c12;
        }
        
        .score-summary {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .instructions {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Estimathon Competition</h1>
        
        <!-- Participant Section -->
        <div id="participantSection">
            <div class="instructions">
                <strong>Instructions:</strong> You have a total of 30 guesses to use across all questions. 
                Each guess counts as the range between your min and max values. 
                Submit each question individually when you're ready. 
                Tighter ranges score more points if correct!
            </div>

            <div class="guess-tracker" id="guessTracker">
                Guesses Remaining: <span id="guessesLeft">30</span> / 30
            </div>

            <div id="totalScore" class="total-score">
                üèÜ Total Score: <span id="scoreValue">0</span> points
                <div class="score-summary">
                    <span>Questions answered: <span id="questionsAnswered">0</span></span>
                    <span>Guesses used: <span id="guessesUsed">0</span></span>
                </div>
            </div>

            <div class="card">
                <h2>Enter Your Estimates</h2>
                
                <div id="questionsContainer">
                    <!-- questions will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="adminSection" class="hidden">
            <div class="card">
                <div class="admin-header">
                    <h2>Admin Panel</h2>
                    <button class="reset-btn" onclick="resetAllData()">Reset All Data</button>
                </div>
                
                <div class="input-group">
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                    <button onclick="unlockAdmin()">Unlock</button>
                </div>
                
                <div id="adminControls" class="hidden">
                    <h3 style="margin: 20px 0;">Add/Edit Questions</h3>
                    
                    <div class="input-group">
                        <input type="text" id="newQuestion" placeholder="Question text">
                        <input type="number" id="correctAnswer" placeholder="Correct answer">
                        <input type="number" id="maxGuess" placeholder="Max allowed guess">
                        <button onclick="addQuestion()">Add Question</button>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px;">Current Questions</h3>
                    <div id="questionsList"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-toggle" onclick="toggleAdmin()">‚öôÔ∏è</div>

    <script>
        const ADMIN_PASSWORD = 'estimathon123';
        const MAX_TOTAL_GUESSES = 30;
        
        // tracking guesses per question
        let submittedGuesses = {};
        let totalGuessesUsed = 0;
        
        // test questions that show the answer
        let questions = JSON.parse(localStorage.getItem('estimathonQuestions')) || [
            { id: 1, text: "Test Question 1: The answer is 42", answer: 42, maxGuess: 100 },
            { id: 2, text: "Test Question 2: The answer is 1337", answer: 1337, maxGuess: 5000 },
            { id: 3, text: "Test Question 3: The answer is 256", answer: 256, maxGuess: 1000 }
        ];

        function saveQuestions() {
            localStorage.setItem('estimathonQuestions', JSON.stringify(questions));
        }

        function updateGuessTracker() {
            const guessesLeft = MAX_TOTAL_GUESSES - totalGuessesUsed;
            document.getElementById('guessesLeft').textContent = guessesLeft;
            
            const tracker = document.getElementById('guessTracker');
            if (guessesLeft <= 10) {
                tracker.classList.add('warning');
            } else {
                tracker.classList.remove('warning');
            }
        }

        function updateTotalScore() {
            let totalScore = 0;
            let questionsAnswered = 0;
            
            Object.values(submittedGuesses).forEach(guess => {
                totalScore += guess.score;
                questionsAnswered++;
            });
            
            document.getElementById('scoreValue').textContent = totalScore;
            document.getElementById('questionsAnswered').textContent = questionsAnswered;
            document.getElementById('guessesUsed').textContent = totalGuessesUsed;
        }

        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            questions.forEach(q => {
                const isSubmitted = submittedGuesses[q.id] !== undefined;
                const questionDiv = document.createElement('div');
                questionDiv.className = `question ${isSubmitted ? 'submitted' : ''}`;
                questionDiv.innerHTML = `
                    <h3>Question ${q.id}: ${q.text}</h3>
                    <div class="input-group">
                        <div style="flex: 1;">
                            <label>Min guess:</label>
                            <input type="number" id="min-${q.id}" placeholder="Minimum" min="0" max="${q.maxGuess}" 
                                   ${isSubmitted ? 'disabled' : ''} 
                                   value="${isSubmitted ? submittedGuesses[q.id].min : ''}">
                        </div>
                        <div style="flex: 1;">
                            <label>Max guess:</label>
                            <input type="number" id="max-${q.id}" placeholder="Maximum" min="0" max="${q.maxGuess}" 
                                   ${isSubmitted ? 'disabled' : ''} 
                                   value="${isSubmitted ? submittedGuesses[q.id].max : ''}">
                        </div>
                        <button class="submit-btn" onclick="submitQuestion(${q.id})" 
                                ${isSubmitted ? 'disabled' : ''}>
                            ${isSubmitted ? 'Submitted' : 'Submit'}
                        </button>
                    </div>
                    <div class="error" id="error-${q.id}"></div>
                    <div class="score-display ${isSubmitted ? (submittedGuesses[q.id].score > 0 ? 'correct' : 'incorrect') : 'hidden'}" 
                         id="score-${q.id}">
                        ${isSubmitted ? getScoreMessage(q.id) : ''}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }

        function getScoreMessage(questionId) {
            const guess = submittedGuesses[questionId];
            const question = questions.find(q => q.id === questionId);
            
            if (guess.score > 0) {
                return `‚úì Correct! Score: ${guess.score} points (Range: ${guess.max - guess.min})`;
            } else {
                return `‚úó Incorrect. The answer was ${question.answer}`;
            }
        }

        function submitQuestion(questionId) {
            // check if we have guesses left
            if (totalGuessesUsed >= MAX_TOTAL_GUESSES) {
                alert('You have used all 30 guesses!');
                return;
            }
            
            const question = questions.find(q => q.id === questionId);
            const minInput = document.getElementById(`min-${questionId}`);
            const maxInput = document.getElementById(`max-${questionId}`);
            const errorDiv = document.getElementById(`error-${questionId}`);
            
            const min = parseFloat(minInput.value);
            const max = parseFloat(maxInput.value);
            
            // reset error
            errorDiv.textContent = '';
            
            // validate
            if (!min && min !== 0 || !max && max !== 0) {
                errorDiv.textContent = 'Please enter both min and max values';
                return;
            }
            
            if (min > max) {
                errorDiv.textContent = 'Min must be less than or equal to max';
                return;
            }
            
            if (max > question.maxGuess) {
                errorDiv.textContent = `Max guess cannot exceed ${question.maxGuess}`;
                return;
            }
            
            // calculate score
            let score = 0;
            if (min <= question.answer && max >= question.answer) {
                // base score
                score = 100;
                
                // bonus for tight range - more aggressive bonus
                const range = max - min;
                const rangeRatio = range / question.maxGuess;
                const rangeBonus = Math.round(100 * (1 - rangeRatio));
                score += Math.max(0, rangeBonus);
            }
            
            // save the guess
            submittedGuesses[questionId] = {
                min: min,
                max: max,
                score: score
            };
            
            totalGuessesUsed++;
            updateGuessTracker();
            updateTotalScore();
            
            // re-render to show submitted state
            renderQuestions();
        }

        function toggleAdmin() {
            const adminSection = document.getElementById('adminSection');
            const participantSection = document.getElementById('participantSection');
            
            if (adminSection.classList.contains('hidden')) {
                adminSection.classList.remove('hidden');
                participantSection.classList.add('hidden');
            } else {
                adminSection.classList.add('hidden');
                participantSection.classList.remove('hidden');
            }
        }

        function unlockAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('adminControls').classList.remove('hidden');
                renderAdminQuestions();
            } else {
                alert('Incorrect password');
            }
        }

        function renderAdminQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';
            
            questions.forEach(q => {
                const div = document.createElement('div');
                div.className = 'question';
                div.innerHTML = `
                    <p><strong>Q${q.id}:</strong> ${q.text}</p>
                    <p>Answer: ${q.answer} | Max guess: ${q.maxGuess}</p>
                    <button onclick="deleteQuestion(${q.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); margin-top: 10px;">
                        Delete
                    </button>
                `;
                list.appendChild(div);
            });
        }

        function addQuestion() {
            const questionText = document.getElementById('newQuestion').value;
            const answer = parseFloat(document.getElementById('correctAnswer').value);
            const maxGuess = parseFloat(document.getElementById('maxGuess').value);
            
            if (!questionText || (!answer && answer !== 0) || !maxGuess) {
                alert('Please fill in all fields');
                return;
            }
            
            const newId = Math.max(...questions.map(q => q.id), 0) + 1;
            questions.push({
                id: newId,
                text: questionText,
                answer: answer,
                maxGuess: maxGuess
            });
            
            saveQuestions();
            renderAdminQuestions();
            renderQuestions();
            
            // clear inputs
            document.getElementById('newQuestion').value = '';
            document.getElementById('correctAnswer').value = '';
            document.getElementById('maxGuess').value = '';
        }

        function deleteQuestion(id) {
            questions = questions.filter(q => q.id !== id);
            // also remove any submitted guesses for this question
            if (submittedGuesses[id]) {
                totalGuessesUsed--;
                delete submittedGuesses[id];
                updateGuessTracker();
                updateTotalScore();
            }
            saveQuestions();
            renderAdminQuestions();
            renderQuestions();
        }

        function resetAllData() {
            if (confirm('Are you sure you want to reset all questions to defaults? This will also clear all submitted guesses.')) {
                localStorage.removeItem('estimathonQuestions');
                submittedGuesses = {};
                totalGuessesUsed = 0;
                location.reload();
            }
        }

        // initialize
        renderQuestions();
        updateGuessTracker();
        updateTotalScore();
    </script>
</body>
</html>